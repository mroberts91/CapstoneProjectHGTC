<?php
$pagetitle = 'Insert Customer';
require_once 'header.php';
require_once 'connect.php';

$errormsg = "";
$showform = 1;
	

		if( isset($_POST['MBsubmit']) )
		{
		echo '<p>The form was submitted.</p>';

			//Data Cleansing
			$formfield['ffname'] = trim($_POST['MBname']);
			$formfield['fflastname'] = trim(strtolower($_POST['MBlastname']));
			$formfield['ffaddress'] = trim(strtolower($_POST['MBaddress']));
			$formfield['ffemail'] = trim(strtolower($_POST['MBemail']));
			$formfield['ffphone'] = trim(strtolower($_POST['MBphone']));
			$formfield['ffmaillist'] = trim(strtolower($_POST['MBmailist']));


		
			/*  ****************************************************************************
     		CHECK FOR EMPTY FIELDS
    		Complete the lines below for any REQIURED form fields only.
			Do not do for optional fields.
    		**************************************************************************** */
			if(empty($formfield['ffname'])){$errormsg .= "<p>Your name is empty.</p>";}
			if(empty($formfield['fflastname'])){$errormsg .= "<p>Your last name is empty.</p>";}
			if(empty($formfield['ffaddress'])){$errormsg .= "<p>Your address is empty.</p>";}
			if(empty($formfield['ffemail'])){$errormsg .= "<p>Your email is empty</p>";}
			if(empty($formfield['ffphone'])){$errormsg .= "<p>Your phone is empty.</p>";}
		
			
			
			
			//VALIDATE THE EMAIL
    		if (!filter_var($formfield['ffemail'], FILTER_VALIDATE_EMAIL))
			{
				$errormsg .= "<p>Your email is not valid.</p>";
			}

			/*  ****************************************************************************
			DISPLAY ERRORS
			If we have concatenated the error message with details, then let the user know
			**************************************************************************** */
			if($errormsg != "")
			{
				echo "<div class='error'><p>THERE ARE ERRORS!</p>";
				echo $errormsg;
				echo "</div>";
			}
			else
			{
				try
				{
					//enter data into database
					$sqlinsert = 'INSERT INTO customers (dbfirstname, dblastname, dbaddress, dbemail, dbphone, dbmaillist)
								  VALUES (:bvname, :bvlastname, :bvaddress, :bvemail, :bvphone, :bvmaillist)';
					$stmtinsert = $db->prepare($sqlinsert);
					$stmtinsert->bindvalue(':bvname', $formfield['ffname']);
					$stmtinsert->bindvalue(':bvlastname', $formfield['fflastname']);
					$stmtinsert->bindvalue(':bvaddress', $formfield['ffaddress']);
					$stmtinsert->bindvalue(':bvemail', $formfield['ffemail']);
					$stmtinsert->bindvalue(':bvphone', $formfield['ffphone']);
					$stmtinsert->bindvalue(':bvmaillist', $formfield['ffmaillist']);
					$stmtinsert->execute();
					echo "<div class='success'><p>There are no errors.  Thank you.</p></div>";
				}//try
				catch(PDOException $e)
				{
					echo 'ERROR!!!' .$e->getMessage();
					exit();
				}
			}//else statement end
	
		}//if isset submit


	$sqlselect = 'SELECT dbfirstname, dblastname, dbaddress, dbemail, dbphone, dbmaillist from customers';

	$result = $db-> query($sqlselect);

if($visible == 1 && $_SESSION['loginpermit'] == 1 || $_SESSION['loginpermit'] == 2 )
{
	?>
		<form method="post" action="contactcomplete.php" name="MBform">
			<fieldset><legend>Personal Information</legend>
				<table border>
					<tr>
						<th><label for="MBname">First Name:</label></th>
						<td><input type="text" name="MBname" id="MBname" value="<?php if( isset($formfield['ffname'])){
						    echo $formfield['ffname'];}?>"/></td>
					</tr>
					<tr>
						<th><label for="MBlastname">Last Name:</label></th>
						<td><input type="text" name="MBlastname" id="MBlastname" value="<?php if( isset($formfield['fflastname'])){
						    echo $formfield['fflastname'];}?>" /></td>
					</tr>
					<tr>
						<th><label for="MBaddress">Address:</label></th>
						<td><input type="text" name="MBaddress" id="MBaddress" value="<?php if( isset($formfield['ffaddress'])){
						    echo $formfield['ffaddress'];}?>" /></td>
					</tr>
					<tr>
						<th><label for="MBemail">Email:</label></th>
						<td><input type="text" name="MBemail" id="MBemail" value="<?php if( isset($formfield['ffemail'])){
						    echo $formfield['ffemail'];}?>" /></td>
					</tr>
					<tr>
						<th><label for="MBphone">Phone:</label></th>
						<td><input type="text" name="MBphone" id="MBphone" value="<?php if( isset($formfield['ffphone'])){
						    echo $formfield['ffphone'];}?>" /></td>
					</tr>
					<tr>
						<th>Would you like to join our mailing list? </th>
						<td><input type="radio" name="MBmailist" id="valueyes" 
									value="yes" <?php if( isset($formfield['ffmaillist']) && $formfield['ffmaillist'] == "yes" ){
									    echo ' checked';}?> />
							<label for="valueyes">Yes</label>
							<input type="radio" name="MBmailist" id="valueno" 
									value="no" <?php if( isset($formfield['ffmaillist']) && $formfield['ffmaillist'] == "no" ){
									    echo ' checked';}?>/><label for="valueno">No</label>
							
						</td>
					</tr>
					<tr>
						<th>Submit:</th>
						<td><input type="submit" name="MBsubmit" value="Submit" /></td>
					</tr>
				</table>
			</fieldset>
		</form>
			<br><br>
	
<?php
}
include_once 'footer.php';
?>	